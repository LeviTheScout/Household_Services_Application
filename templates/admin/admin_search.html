{% extends 'layout.html' %}

{% block title %}
    Admin Search
{% endblock %}

{% block content %}
    <h1>Admin Search</h1>
    <form method="POST" action="{{ url_for('admin_search') }}">
        <!-- Dropdown to select search type -->
        <label for="search_type">Select Search Type:</label>
        <select name="search_type" id="search_type" onchange="this.form.submit()">
            <option value="" disabled selected>Select a type</option>

            <option value="service_professionals" {% if search_type == 'service_professionals' %}selected{% endif %}>Service Professionals</option>
            <option value="services" {% if search_type == 'services' %}selected{% endif %}>Services</option>
            <option value="customers" {% if search_type == 'customers' %}selected{% endif %}>Customers</option>
        </select>
    
        <!-- Input for search term -->
        <label for="search_term">Search Term:</label>
        <input type="text" name="search_term" id="search_term" value="{{ search_term }}">
    
        <button type="submit">Search</button>
    </form>

    <!-- Search Results Section -->
    {% if search_type == 'service_requests' %}
        <h2>Service Requests</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Service Name</th>
                    <th>Customer Name</th>
                    <th>Professional Name</th>
                    <th>Pincode</th>
                    <th>Request Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for request in requests %}
                <tr>
                    <td>{{ request.service.name }}</td>
                    <td>
                        <a href="{{ url_for('customer_profile', customer_id=request.customer.id) }}">
                            {{ request.customer.user.name }}
                        </a>
                    </td>
                    <td>
                        <a href="{{ url_for('professional_profile', professional_id=request.professional.id) }}">
                            {{ request.professional.user.name }}
                        </a>
                    </td>
                    <td>{{ request.customer.user.pincode }}</td>
                    <td>{{ request.date_of_request.strftime('%Y-%m-%d') }}</td>
                    <td>{{ request.service_status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% elif search_type == 'customers' %}
        <h2>Customers</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Pincode</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr>
                    <td>
                        <a href="{{ url_for('customer_profile', customer_id=customer.id) }}">
                            {{ customer.user.name }}
                        </a>
                    </td>
                    <td>{{ customer.user.address }}</td>
                    <td>{{ customer.user.pincode }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% elif search_type == 'service_professionals' %}
        <h2>Service Professionals</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Service</th>
                    <th>Pincode</th>
                    <th>Experience</th>
                </tr>
            </thead>
            <tbody>
                {% for professional in professionals %}
                <tr>
                    <td>
                        <a href="{{ url_for('professional_profile', professional_id=professional.id) }}">
                            {{ professional.user.name }}
                        </a>
                    </td>
                    <td>{{ professional.service.name }}</td>
                    <td>{{ professional.user.pincode }}</td>
                    <td>{{ professional.experience }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% elif search_type == 'services' %}
        <h2>Services</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for service in services %}
                <tr>
                    <td>{{ service.name }}</td>
                    <td>{{ service.description }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}